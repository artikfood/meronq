<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Artik Food ‚Äî Premium Delivery</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-main: #0f1115; --bg-secondary: #151822; --bg-card: rgba(255,255,255,0.06);
      --bg-glass: rgba(255,255,255,0.08); --border-glass: rgba(255,255,255,0.12);
      --accent-gold: #d4af37; --accent-green: #2ecc71; --text-main: #f4f4f4;
      --text-muted: #b3b3b3; --shadow-soft: 0 10px 30px rgba(0,0,0,0.35);
      --radius-xl: 20px;
    }
    body { margin: 0; font-family: "Inter", sans-serif; background: var(--bg-main); color: var(--text-main); line-height: 1.5; }
    header { position: sticky; top: 0; z-index: 1000; background: rgba(15,17,21,0.95); backdrop-filter: blur(10px); border-bottom: 1px solid var(--border-glass); padding: 14px 20px; display: flex; justify-content: space-between; align-items: center; }
    header h1 { font-family: "Playfair Display", serif; color: var(--accent-gold); margin: 0; font-size: 22px; cursor: pointer; }
    .hero { padding: 60px 20px; text-align: center; background: radial-gradient(circle at top, rgba(212,175,55,0.15), transparent); }
    .hero h2 { font-family: "Playfair Display", serif; font-size: 36px; margin-bottom: 10px; }
    .section { padding: 40px 20px; max-width: 1000px; margin: auto; }
    .shops-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    .shop-card { background: var(--bg-card); border: 1px solid var(--border-glass); border-radius: var(--radius-xl); padding: 20px; cursor: pointer; transition: 0.3s; text-align: center; }
    .shop-card:hover { border-color: var(--accent-gold); transform: translateY(-3px); }
    .shop-card img { width: 80px; height: 80px; border-radius: 50%; margin-bottom: 15px; object-fit: cover; background: #333; }
    .product { display: flex; align-items: center; gap: 15px; background: var(--bg-glass); border: 1px solid var(--border-glass); padding: 15px; border-radius: 15px; margin-bottom: 10px; }
    .product img { width: 70px; height: 70px; border-radius: 12px; object-fit: cover; }
    .product-info { flex-grow: 1; }
    .product-info h4 { margin: 0; font-size: 16px; }
    .product-info p { margin: 4px 0; font-size: 13px; color: var(--text-muted); }
    .price { font-weight: 700; color: var(--accent-gold); }
    .qty-controls { display: flex; align-items: center; gap: 10px; }
    .qty-controls button { width: 30px; height: 30px; border-radius: 50%; border: none; background: var(--accent-green); color: #000; font-weight: 700; cursor: pointer; }
    .hidden { display: none; }
    .order-form { background: var(--bg-secondary); padding: 25px; border-radius: var(--radius-xl); border: 1px solid var(--border-glass); max-width: 500px; margin: 20px auto; }
    .order-form input, .order-form select, .order-form textarea { width: 100%; padding: 12px; margin-bottom: 12px; border-radius: 10px; border: 1px solid var(--border-glass); background: rgba(255,255,255,0.05); color: #fff; }
    .btn-send { width: 100%; padding: 15px; border-radius: 30px; border: none; background: var(--accent-green); color: #000; font-weight: 700; font-size: 16px; cursor: pointer; }
    .back-btn { background: none; border: 1px solid var(--accent-gold); color: var(--accent-gold); padding: 8px 15px; border-radius: 20px; cursor: pointer; margin-bottom: 20px; }
  </style>
</head>
<body>

<header>
  <h1 onclick="goHome()">Artik Food</h1>
  <div id="cart-counter" onclick="scrollToCart()" style="cursor:pointer">üõí <span id="cart-count-val">0</span></div>
</header>

<div id="home-page">
  <section class="hero">
    <h2>Premium –î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ê—Ä—Ç–∏–∫–µ</h2>
    <p>–õ—É—á—à–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –≤ –æ–¥–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</p>
  </section>
  <section class="section">
    <div class="shops-grid" id="shops-list">
      </div>
  </section>
</div>

<div id="store-page" class="hidden">
  <section class="section">
    <button class="back-btn" onclick="goHome()">‚Üê –ù–∞–∑–∞–¥ –∫ –º–∞–≥–∞–∑–∏–Ω–∞–º</button>
    <h2 id="store-title" style="font-family: 'Playfair Display'; color: var(--accent-gold);"></h2>
    <div id="products-list"></div>
  </section>
</div>

<section class="section" id="cart-section">
  <h3>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h3>
  <div class="order-form">
    <div id="cart-preview" style="margin-bottom: 20px; border-bottom: 1px solid var(--border-glass); padding-bottom: 10px;">
      </div>
    <div id="total-price" style="font-weight: 700; margin-bottom: 15px; text-align: right;">–ò—Ç–æ–≥–æ: 0 AMD</div>
    
    <input type="text" id="cust-name" placeholder="–í–∞—à–µ –∏–º—è">
    <input type="tel" id="cust-phone" placeholder="–í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω">
    <input type="text" id="cust-address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞">
    <select id="cust-district">
      <option value="–ê—Ä—Ç–∏–∫">–ê—Ä—Ç–∏–∫ (500 AMD –¥–æ—Å—Ç–∞–≤–∫–∞)</option>
      <option value="–ê—Ä–∏—á">–ê—Ä–∏—á (700 AMD –¥–æ—Å—Ç–∞–≤–∫–∞)</option>
      <option value="–ù–æ—Ä-–ö—è–Ω–∫">–ù–æ—Ä-–ö—è–Ω–∫ (1000 AMD –¥–æ—Å—Ç–∞–≤–∫–∞)</option>
      <option value="–ü–µ–º–∑–∞—à–µ–Ω">–ü–µ–º–∑–∞—à–µ–Ω (1000 AMD –¥–æ—Å—Ç–∞–≤–∫–∞)</option>
    </select>
    <textarea id="cust-comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞)"></textarea>
    <button class="btn-send" onclick="submitOrder()">–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ó–ê–ö–ê–ó</button>
  </div>
</section>

<script>
  // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
  const WORKER_URL = "https://meronq.edulik844.workers.dev/orders";
  const API_KEY = "meronq_Secret_2026!"; // –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ç–∞–∫–æ–π –∂–µ –≤ Cloudflare

  const myStores = [
    { id: 'hay_grill', name: 'Hay Grill', logo: 'stores/hay_grill/logo.jpg' }
    // –°—é–¥–∞ –¥–æ–±–∞–≤–ª—è–π –Ω–æ–≤—ã–µ –º–∞–≥–∞–∑–∏–Ω—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
  ];

  let carts = {}; // { storeId: { productName: {qty, price} } }

  // --- –õ–û–ì–ò–ö–ê ---

  function init() {
    const list = document.getElementById('shops-list');
    myStores.forEach(s => {
      const card = document.createElement('div');
      card.className = 'shop-card';
      card.onclick = () => openStore(s.id, s.name);
      card.innerHTML = `
        <img src="${s.logo}" onerror="this.src='https://via.placeholder.com/80?text=Shop'">
        <h3>${s.name}</h3>
        <p>–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –º–µ–Ω—é</p>
      `;
      list.appendChild(card);
    });
    updateCartUI();
  }

  async function openStore(id, name) {
    document.getElementById('home-page').classList.add('hidden');
    document.getElementById('store-page').classList.remove('hidden');
    document.getElementById('store-title').innerText = name;
    
    const list = document.getElementById('products-list');
    list.innerHTML = "–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é...";

    try {
      const resp = await fetch(`stores/${id}/menu.csv`);
      const text = await resp.text();
      const rows = text.split('\n').filter(r => r.trim().length > 5);
      
      list.innerHTML = "";
      rows.forEach(row => {
        const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if (cols.length < 4) return;

        const category = cols[0].replace(/"/g, '').trim();
        const desc = cols[1].replace(/"/g, '').trim();
        const pName = cols[2].replace(/"/g, '').trim();
        const rawPrice = cols[4].replace(/"/g, '').trim();

        // –ü–∞—Ä—Å–∏–º —Ü–µ–Ω—É (–±–µ—Ä–µ–º –ø–µ—Ä–≤—É—é, –µ—Å–ª–∏ —Ç–∞–º 950/1250)
        const price = parseInt(rawPrice.split('/')[0].replace(/\D/g, '')) || 0;

        const itemEl = document.createElement('div');
        itemEl.className = 'product';
        itemEl.innerHTML = `
          <img src="stores/${id}/images/${pName}.jpg" onerror="this.src='https://via.placeholder.com/70?text=Food'">
          <div class="product-info">
            <h4>${pName}</h4>
            <p>${desc}</p>
            <span class="price">${price} AMD</span>
          </div>
          <div class="qty-controls">
            <button onclick="changeQty('${id}', '${pName}', ${price}, -1)">-</button>
            <span id="qty-${id}-${pName.replace(/\s/g,'')}">${(carts[id] && carts[id][pName]) ? carts[id][pName].qty : 0}</span>
            <button onclick="changeQty('${id}', '${pName}', ${price}, 1)">+</button>
          </div>
        `;
        list.appendChild(itemEl);
      });
    } catch (e) {
      list.innerHTML = "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª menu.csv –≤ –ø–∞–ø–∫–µ –º–∞–≥–∞–∑–∏–Ω–∞.";
    }
  }

  function changeQty(storeId, pName, price, delta) {
    if (!carts[storeId]) carts[storeId] = {};
    if (!carts[storeId][pName]) carts[storeId][pName] = { qty: 0, price: price };

    carts[storeId][pName].qty += delta;
    if (carts[storeId][pName].qty <= 0) delete carts[storeId][pName];
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–∏—Ñ—Ä—É –≤ –º–µ–Ω—é
    const el = document.getElementById(`qty-${storeId}-${pName.replace(/\s/g,'')}`);
    if (el) el.innerText = carts[storeId][pName] ? carts[storeId][pName].qty : 0;
    
    updateCartUI();
  }

  function updateCartUI() {
    const preview = document.getElementById('cart-preview');
    const totalEl = document.getElementById('total-price');
    const countEl = document.getElementById('cart-count-val');
    
    preview.innerHTML = "";
    let total = 0;
    let count = 0;

    for (let sId in carts) {
      for (let pName in carts[sId]) {
        const item = carts[sId][pName];
        total += item.qty * item.price;
        count += item.qty;
        preview.innerHTML += `<div>${pName} x ${item.qty} ‚Äî ${item.qty * item.price} AMD</div>`;
      }
    }

    if (count === 0) preview.innerHTML = "–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞";
    totalEl.innerText = `–ò—Ç–æ–≥–æ —Ç–æ–≤–∞—Ä—ã: ${total} AMD`;
    countEl.innerText = count;
  }

  async function submitOrder() {
    const name = document.getElementById('cust-name').value;
    const phone = document.getElementById('cust-phone').value;
    const address = document.getElementById('cust-address').value;
    const district = document.getElementById('cust-district').value;
    const comment = document.getElementById('cust-comment').value;

    if (!name || !phone || !address) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!");

    // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –í–æ—Ä–∫–µ—Ä–∞
    const productsArray = [];
    for (let sId in carts) {
      for (let pName in carts[sId]) {
        productsArray.push({
          storeKey: sId,
          name: pName,
          quantity: carts[sId][pName].qty,
          unitPrice: carts[sId][pName].price
        });
      }
    }

    if (productsArray.length === 0) return alert("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!");

    const btn = document.querySelector('.btn-send');
    btn.disabled = true;
    btn.innerText = "–û–¢–ü–†–ê–í–ö–ê...";

    try {
      const response = await fetch(WORKER_URL, {
        method: 'POST',
        headers: { 
          'Content-Type': 'application/json',
          'x-api-key': API_KEY 
        },
        body: JSON.stringify({
          name, phone, address, district, comment,
          products: productsArray,
          carts: {} // –í–æ—Ä–∫–µ—Ä —Å–∞–º —Ä–∞–∑–±–µ—Ä–µ—Ç –ø—Ä–æ–¥—É–∫—Ç—ã
        })
      });

      if (response.ok) {
        alert("‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ Telegram!");
        location.reload();
      } else {
        alert("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API Key –≤ Cloudflare.");
      }
    } catch (e) {
      alert("‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏.");
    } finally {
      btn.disabled = false;
      btn.innerText = "–ü–û–î–¢–í–ï–†–î–ò–¢–¨ –ó–ê–ö–ê–ó";
    }
  }

  function goHome() {
    document.getElementById('home-page').classList.remove('hidden');
    document.getElementById('store-page').classList.add('hidden');
    window.scrollTo(0,0);
  }

  function scrollToCart() {
    document.getElementById('cart-section').scrollIntoView({behavior:'smooth'});
  }

  window.onload = init;
</script>

</body>
</html>
