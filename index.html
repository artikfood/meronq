<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Artik Food ‚Äî Premium Delivery</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f1115">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-main: #0f1115; --bg-secondary: #151822; --bg-card: rgba(255,255,255,0.06);
      --bg-glass: rgba(255,255,255,0.08); --border-glass: rgba(255,255,255,0.12);
      --accent-gold: #d4af37; --accent-green: #2ecc71; --text-main: #f4f4f4;
      --text-muted: #b3b3b3; --shadow-soft: 0 10px 30px rgba(0,0,0,0.35);
      --shadow-hover: 0 16px 40px rgba(0,0,0,0.5); --radius-xl: 20px; --radius-lg: 16px;
    }
    body.light-theme {
      --bg-main: #f7f7f9; --bg-secondary: #ffffff; --bg-card: rgba(0,0,0,0.04);
      --bg-glass: rgba(0,0,0,0.05); --border-glass: rgba(0,0,0,0.12);
      --accent-gold: #b08a1f; --accent-green: #27ae60; --text-main: #1c1c1e; --text-muted: #6e6e73;
    }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { margin: 0; font-family: 'Inter', sans-serif; background-color: var(--bg-main); color: var(--text-main); transition: background 0.3s, color 0.3s; overflow-x: hidden; }
    header { position: sticky; top: 0; z-index: 1000; background: rgba(15,17,21,0.8); backdrop-filter: blur(12px); border-bottom: 1px solid var(--border-glass); padding: 14px 20px; display: flex; justify-content: space-between; align-items: center; transition: 0.3s; }
    body.light-theme header { background: rgba(255,255,255,0.8); }
    .logo-box h1 { margin: 0; font-family: 'Playfair Display', serif; font-size: 24px; background: linear-gradient(135deg, var(--accent-gold), #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; cursor: pointer; }
    .nav-actions { display: flex; gap: 12px; align-items: center; }
    .icon-btn { width: 42px; height: 42px; border-radius: 50%; border: 1px solid var(--border-glass); background: var(--bg-glass); color: var(--text-main); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; transition: 0.2s; position: relative; }
    .icon-btn:hover { background: var(--accent-gold); color: #000; border-color: var(--accent-gold); }
    .badge { position: absolute; top: -5px; right: -5px; background: var(--accent-green); color: #000; font-size: 10px; font-weight: 700; padding: 2px 6px; border-radius: 10px; border: 2px solid var(--bg-main); }
    
    .hero { padding: 60px 20px; text-align: center; background: radial-gradient(circle at top, rgba(212,175,55,0.12), transparent 70%); }
    .hero h2 { font-family: 'Playfair Display', serif; font-size: 38px; margin-bottom: 12px; font-weight: 700; letter-spacing: -0.5px; }
    .hero p { color: var(--text-muted); font-size: 16px; max-width: 600px; margin: 0 auto; }

    .search-box { max-width: 500px; margin: 30px auto 0; position: relative; }
    .search-box input { width: 100%; padding: 16px 20px 16px 50px; border-radius: 30px; border: 1px solid var(--border-glass); background: var(--bg-secondary); color: var(--text-main); font-size: 15px; outline: none; transition: 0.3s; }
    .search-box input:focus { border-color: var(--accent-gold); box-shadow: 0 0 15px rgba(212,175,55,0.2); }
    .search-box i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

    .section-title { padding: 40px 20px 20px; max-width: 1100px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .section-title h3 { font-size: 22px; font-family: 'Playfair Display', serif; margin: 0; }

    .shops-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; padding: 0 20px 40px; max-width: 1100px; margin: 0 auto; }
    .shop-card { background: var(--bg-secondary); border: 1px solid var(--border-glass); border-radius: var(--radius-xl); overflow: hidden; cursor: pointer; transition: 0.3s ease; position: relative; }
    .shop-card:hover { transform: translateY(-8px); border-color: var(--accent-gold); box-shadow: var(--shadow-hover); }
    .shop-img { width: 100%; height: 160px; object-fit: cover; }
    .shop-content { padding: 20px; }
    .shop-content h4 { margin: 0 0 8px; font-size: 19px; }
    .shop-meta { display: flex; gap: 15px; font-size: 13px; color: var(--text-muted); }
    .shop-badge { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.6); backdrop-filter: blur(5px); color: #fff; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; border: 1px solid rgba(255,255,255,0.1); }

    /* Store Menu Overlay */
    #store-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-main); z-index: 2000; overflow-y: auto; display: none; }
    .store-header { position: sticky; top: 0; background: var(--bg-main); padding: 15px 20px; border-bottom: 1px solid var(--border-glass); display: flex; align-items: center; gap: 15px; z-index: 10; }
    .close-btn { background: var(--bg-glass); border: none; color: var(--text-main); font-size: 20px; cursor: pointer; width: 40px; height: 40px; border-radius: 50%; }
    
    .product-list { padding: 20px; max-width: 800px; margin: 0 auto; }
    .product-item { display: flex; align-items: center; gap: 15px; padding: 15px; background: var(--bg-card); border-radius: var(--radius-lg); margin-bottom: 15px; border: 1px solid var(--border-glass); }
    .product-item img { width: 80px; height: 80px; border-radius: 12px; object-fit: cover; }
    .product-info { flex-grow: 1; }
    .product-info h5 { margin: 0; font-size: 16px; }
    .product-info p { margin: 4px 0; font-size: 13px; color: var(--text-muted); }
    .product-price { font-weight: 700; color: var(--accent-gold); }
    .qty-btn { background: var(--accent-green); border: none; color: #000; width: 30px; height: 30px; border-radius: 50%; font-weight: 700; cursor: pointer; }
    
    /* MODALS & BASKET */
    .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); display: none; z-index: 3000; justify-content: center; align-items: center; }
    .modal-content { background: var(--bg-secondary); width: 95%; max-width: 500px; border-radius: var(--radius-xl); border: 1px solid var(--border-glass); max-height: 90vh; overflow-y: auto; padding: 25px; position: relative; }
    
    .basket-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border-glass); }
    .checkout-form input, .checkout-form select, .checkout-form textarea { width: 100%; padding: 14px; margin-bottom: 15px; border-radius: 12px; border: 1px solid var(--border-glass); background: var(--bg-main); color: #fff; font-size: 15px; outline: none; }
    .checkout-btn { width: 100%; padding: 18px; border-radius: 35px; border: none; background: linear-gradient(135deg, #2ecc71, #27ae60); color: #000; font-weight: 700; font-size: 16px; cursor: pointer; box-shadow: 0 8px 20px rgba(46,204,113,0.3); }

    .hidden { display: none; }
  </style>
</head>
<body class="dark-theme">

<header id="mainHeader">
  <div class="logo-box" onclick="location.reload()">
    <h1>Artik Food</h1>
  </div>
  <div class="nav-actions">
    <div class="icon-btn" onclick="toggleTheme()" id="themeBtn">üåô</div>
    <div class="icon-btn" onclick="openHistory()">üìú</div>
    <div class="icon-btn" onclick="openBasket()">
      üõí <span class="badge" id="cart-badge">0</span>
    </div>
  </div>
</header>
<main id="home-view">
  <section class="hero">
    <div class="shop-badge" style="position:static; display:inline-block; margin-bottom:15px; background:var(--bg-glass)">Artik Premium Service</div>
    <h2>–ò–∑—ã—Å–∫–∞–Ω–Ω–∞—è –µ–¥–∞ <br> <span style="color:var(--accent-gold)">—Å –¥–æ—Å—Ç–∞–≤–∫–æ–π –∫ –¥–≤–µ—Ä—è–º</span></h2>
    <p>–ú—ã —Å–æ–±—Ä–∞–ª–∏ –ª—É—á—à–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞ –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ. <br> –ë—ã—Å—Ç—Ä–æ. –í–∫—É—Å–Ω–æ. –ù–∞–¥–µ–∂–Ω–æ.</p>
    
    <div class="search-box">
      <input type="text" placeholder="–ü–æ–∏—Å–∫ –±–ª—é–¥ –∏–ª–∏ –∑–∞–≤–µ–¥–µ–Ω–∏–π..." id="mainSearch">
      <i>üîç</i>
    </div>
  </section>

  <div class="section-title">
    <h3>–ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è</h3>
  </div>

  <div class="shops-grid" id="shops-list">
    </div>
</main>

<div id="store-overlay">
  <div class="store-header">
    <button class="close-btn" onclick="closeStore()">‚úï</button>
    <h3 id="overlay-title" style="margin:0; font-family:'Playfair Display';">–ú–µ–Ω—é</h3>
  </div>
  <div id="product-container" class="product-list">
    </div>
</div>

<div class="modal" id="basketModal">
  <div class="modal-content">
    <button class="close-btn" style="position:absolute; right:15px; top:15px;" onclick="closeBasket()">‚úï</button>
    <h3 style="font-family:'Playfair Display'; margin-bottom:20px;">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞</h3>
    <div id="basket-items-list"></div>
    
    <div style="margin-top:20px; border-top:1px solid var(--border-glass); padding-top:15px;">
      <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
        <span>–°—É–º–º–∞ —Ç–æ–≤–∞—Ä–æ–≤:</span><span id="items-sum">0 AMD</span>
      </div>
      <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
        <span>–î–æ—Å—Ç–∞–≤–∫–∞:</span><span id="delivery-sum">0 AMD</span>
      </div>
      <div style="display:flex; justify-content:space-between; font-weight:700; color:var(--accent-gold); font-size:18px;">
        <span>–ò—Ç–æ–≥–æ:</span><span id="total-sum">0 AMD</span>
      </div>
    </div>
    <button class="checkout-btn" style="margin-top:20px;" onclick="openCheckout()">–û–§–û–†–ú–ò–¢–¨ –ó–ê–ö–ê–ó</button>
  </div>
</div>

<div class="modal" id="checkoutModal">
  <div class="modal-content checkout-form">
    <button class="close-btn" style="position:absolute; right:15px; top:15px;" onclick="closeCheckout()">‚úï</button>
    <h3 style="font-family:'Playfair Display'; margin-bottom:20px;">–î–æ—Å—Ç–∞–≤–∫–∞</h3>
    <input type="text" id="cust-name" placeholder="–í–∞—à–µ –∏–º—è">
    <input type="tel" id="cust-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞">
    <input type="text" id="cust-address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞">
    <select id="cust-district" onchange="calculateTotals()">
      <option value="–ê—Ä—Ç–∏–∫">–ê—Ä—Ç–∏–∫ (500 AMD)</option>
      <option value="–ê—Ä–∏—á">–ê—Ä–∏—á (700 AMD)</option>
      <option value="–ù–æ—Ä-–ö—è–Ω–∫">–ù–æ—Ä-–ö—è–Ω–∫ (1000 AMD)</option>
      <option value="–ü–µ–º–∑–∞—à–µ–Ω">–ü–µ–º–∑–∞—à–µ–Ω (1000 AMD)</option>
    </select>
    <textarea id="cust-comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–∫–æ–¥ –¥–æ–º–æ—Ñ–æ–Ω–∞, –ø–æ–∂–µ–ª–∞–Ω–∏—è)"></textarea>
    <button class="checkout-btn" onclick="sendOrder()">–û–¢–ü–†–ê–í–ò–¢–¨ –í TELEGRAM</button>
  </div>
</div>
<script>
  // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
  const WORKER_URL = "https://meronq.edulik844.workers.dev/orders";
  const API_KEY = "meronq_Secret_2026!"; 
  
  // –°–ø–∏—Å–æ–∫ —Ç–≤–æ–∏—Ö –º–∞–≥–∞–∑–∏–Ω–æ–≤. –ö–æ–¥ —Å–∞–º –Ω–∞–π–¥–µ—Ç –ø–∞–ø–∫—É —Å —Ç–∞–∫–∏–º –∂–µ id.
  const myStores = [
    { id: 'hay_grill', name: 'Hay Grill', category: '–ì—Ä–∏–ª—å ‚Ä¢ –®–∞—à–ª—ã–∫', time: '30-45 –º–∏–Ω', logo: 'stores/hay_grill/logo.jpg' },
    { id: 'million', name: 'Million', category: '–§–∞—Å—Ç—Ñ—É–¥ ‚Ä¢ –ë—É—Ä–≥–µ—Ä—ã', time: '20-35 –º–∏–Ω', logo: 'stores/million/logo.jpg' }
  ];

  let carts = JSON.parse(localStorage.getItem('artik_carts')) || {};

  // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
  function init() {
    const list = document.getElementById('shops-list');
    list.innerHTML = "";
    myStores.forEach(s => {
      const card = document.createElement('div');
      card.className = 'shop-card';
      card.onclick = () => openStore(s.id, s.name);
      card.innerHTML = `
        <img src="${s.logo}" class="shop-img" onerror="this.src='https://via.placeholder.com/300x160?text=${s.name}'">
        <div class="shop-badge">OPEN</div>
        <div class="shop-content">
          <h4>${s.name}</h4>
          <div class="shop-meta">
            <span>‚≠ê 5.0</span>
            <span>‚Ä¢ ${s.category}</span>
            <span>‚Ä¢ ${s.time}</span>
          </div>
        </div>
      `;
      list.appendChild(card);
    });
    updateCartBadge();
  }

  // --- –î–í–ò–ñ–û–ö CSV ---
  async function openStore(id, name) {
    document.getElementById('store-overlay').style.display = 'block';
    document.getElementById('overlay-title').innerText = name;
    document.body.style.overflow = 'hidden';
    
    const container = document.getElementById('product-container');
    container.innerHTML = "<p style='text-align:center;'>–ó–∞–≥—Ä—É–∑–∫–∞ –º–µ–Ω—é...</p>";

    try {
      const response = await fetch(`stores/${id}/menu.csv`);
      const text = await response.text();
      const rows = text.split('\n').filter(r => r.trim().length > 5);
      
      container.innerHTML = "";
      rows.forEach((row, idx) => {
        const cols = row.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
        if (cols.length < 4) return;

        const desc = cols[1].replace(/"/g, '').trim();
        const pName = cols[2].replace(/"/g, '').trim();
        const rawPrice = cols[4].replace(/"/g, '').trim();
        const price = parseInt(rawPrice.split('/')[0].replace(/\D/g, '')) || 0;

        const qty = (carts[id] && carts[id][pName]) ? carts[id][pName].qty : 0;

        const itemEl = document.createElement('div');
        itemEl.className = 'product-item';
        itemEl.innerHTML = `
          <img src="stores/${id}/images/${pName}.jpg" onerror="this.src='https://via.placeholder.com/80?text=Food'">
          <div class="product-info">
            <h5>${pName}</h5>
            <p>${desc}</p>
            <div class="product-price">${price} AMD</div>
          </div>
          <div style="display:flex; align-items:center; gap:10px;">
            <button class="qty-btn" onclick="updateQty('${id}', '${pName}', ${price}, -1, this)">-</button>
            <span class="qty-count">${qty}</span>
            <button class="qty-btn" onclick="updateQty('${id}', '${pName}', ${price}, 1, this)">+</button>
          </div>
        `;
        container.appendChild(itemEl);
      });
    } catch (e) {
      container.innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CSV —Ñ–∞–π–ª.</p>";
    }
  }

  function updateQty(id, pName, price, delta, btn) {
    if (!carts[id]) carts[id] = {};
    if (!carts[id][pName]) carts[id][pName] = { qty: 0, price: price };

    carts[id][pName].qty += delta;
    if (carts[id][pName].qty <= 0) delete carts[id][pName];

    btn.parentElement.querySelector('.qty-count').innerText = (carts[id] && carts[id][pName]) ? carts[id][pName].qty : 0;
    
    localStorage.setItem('artik_carts', JSON.stringify(carts));
    updateCartBadge();
  }

  function updateCartBadge() {
    let count = 0;
    for (let s in carts) for (let p in carts[s]) count += carts[s][p].qty;
    document.getElementById('cart-badge').innerText = count;
  }

  // --- –õ–û–ì–ò–ö–ê –ö–û–†–ó–ò–ù–´ ---
  function openBasket() {
    const list = document.getElementById('basket-items-list');
    list.innerHTML = "";
    let count = 0;

    for (let sId in carts) {
      for (let pName in carts[sId]) {
        count++;
        const item = carts[sId][pName];
        list.innerHTML += `
          <div class="basket-item">
            <div>
              <div style="font-weight:600;">${pName}</div>
              <div style="font-size:12px; color:var(--text-muted);">${sId}</div>
            </div>
            <div>${item.qty} x ${item.price} AMD</div>
          </div>`;
      }
    }
    if (count === 0) list.innerHTML = "<p style='text-align:center;'>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>";
    calculateTotals();
    document.getElementById('basketModal').style.display = 'flex';
  }

  function calculateTotals() {
    let sum = 0;
    for (let sId in carts) for (let pName in carts[sId]) sum += carts[sId][pName].qty * carts[sId][pName].price;
    
    const districts = { "–ê—Ä—Ç–∏–∫": 500, "–ê—Ä–∏—á": 700, "–ù–æ—Ä-–ö—è–Ω–∫": 1000, "–ü–µ–º–∑–∞—à–µ–Ω": 1000 };
    const delivery = sum > 0 ? (districts[document.getElementById('cust-district').value] || 0) : 0;

    document.getElementById('items-sum').innerText = sum + " AMD";
    document.getElementById('delivery-sum').innerText = delivery + " AMD";
    document.getElementById('total-sum').innerText = (sum + delivery) + " AMD";
  }

  // --- –û–¢–ü–†–ê–í–ö–ê ---
  async function sendOrder() {
    const name = document.getElementById('cust-name').value;
    const phone = document.getElementById('cust-phone').value;
    const address = document.getElementById('cust-address').value;
    if (!name || !phone || !address) return alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –¥–æ—Å—Ç–∞–≤–∫–∏!");

    const products = [];
    for (let sId in carts) {
      for (let pName in carts[sId]) {
        products.push({ storeKey: sId, name: pName, quantity: carts[sId][pName].qty, unitPrice: carts[sId][pName].price });
      }
    }

    const btn = document.querySelector('#checkoutModal .checkout-btn');
    btn.disabled = true; btn.innerText = "–û–¢–ü–†–ê–í–ö–ê...";

    try {
      const response = await fetch(WORKER_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-api-key': API_KEY },
        body: JSON.stringify({
          name, phone, address, 
          district: document.getElementById('cust-district').value,
          comment: document.getElementById('cust-comment').value,
          products
        })
      });
      if (response.ok) {
        alert("–ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω! –û–∂–∏–¥–∞–π—Ç–µ –∑–≤–æ–Ω–∫–∞.");
        carts = {}; localStorage.removeItem('artik_carts');
        location.reload();
      } else alert("–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API_KEY.");
    } catch (e) { alert("–û—à–∏–±–∫–∞ —Å–µ—Ç–∏."); }
  }

  function toggleTheme() {
    document.body.classList.toggle('light-theme');
    document.getElementById('themeBtn').innerText = document.body.classList.contains('light-theme') ? "‚òÄÔ∏è" : "üåô";
  }
  function closeStore() { document.getElementById('store-overlay').style.display = 'none'; document.body.style.overflow = 'auto'; }
  function closeBasket() { document.getElementById('basketModal').style.display = 'none'; }
  function openCheckout() { closeBasket(); document.getElementById('checkoutModal').style.display = 'flex'; }
  function closeCheckout() { document.getElementById('checkoutModal').style.display = 'none'; }
  function openHistory() { alert("–ò—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ –≤–∞—à–µ–º –ø—Ä–æ—Ñ–∏–ª–µ –≤—Å–∫–æ—Ä–µ!"); }

  window.onload = init;
</script>
</body>
</html>
